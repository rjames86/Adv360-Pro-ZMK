# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a ZMK (Zephyr Mechanical Keyboard) firmware configuration repository for the Kinesis Advantage 360 Pro keyboard. It's a custom fork of ZMK that builds firmware for this specific split ergonomic keyboard using containerized build environments.

## Development Commands

### Building Firmware
- `make` - Build firmware for both left and right keyboard halves
- `make left` - Build firmware for left half only
- `make clean` - Remove both Docker container and compiled firmware files
- `make clean_firmware` - Remove only firmware files (preserves Docker container)
- `make clean_image` - Remove only Docker container (preserves firmware files)

### Requirements
- Docker or Podman (Podman preferred if both available)
- Make utility
- On macOS: Consider using `colima start --arch x86_64` for Apple Silicon systems

### Firmware Output
Built firmware files are placed in the `firmware/` directory with timestamped filenames in format: `YYYYMMDDHHMM-{commit}-{side}-{clique}.uf2`

## Code Architecture

### Key Configuration Files
- `config/adv360.keymap` - Main keymap configuration in ZMK's devicetree format
- `config/keymap.json` - JSON representation for web-based keymap editors
- `config/info.json` - Keyboard layout metadata for tooling
- `config/west.yml` - West manifest pointing to custom ZMK fork (refil/zmk, branch adv360-z3.5-2)

### Hardware Definition
- `config/boards/arm/adv360/` - Board-specific ZMK configuration
  - `adv360.dtsi` - Main device tree include
  - `adv360_left.dts` / `adv360_right.dts` - Side-specific configurations  
  - `adv360_*_defconfig` - Build configuration for each side
  - `macros.dtsi` - Keyboard macro definitions
  - `adv360-layouts.dtsi` - Physical layout definitions

### Macros and Behaviors
- Macros are defined in both `config/macros.dtsi` and `config/boards/arm/adv360/macros.dtsi`
- Common macros include auto-closing quotes, braces, parentheses, and brackets
- Version macro is auto-generated by `bin/get_version_local.sh` during build

### Build System
- Uses Docker/Podman with ZMK build environment
- `Dockerfile` defines the build container
- `bin/get_version_local.sh` generates version information macro
- Makefile orchestrates the containerized build process

## Key Development Notes

### Keymap Editing
- Primary editing should be done in `config/adv360.keymap` 
- JSON version can be generated using regex replace: `(&.+?)(?=&|\n|$)` â†’ `"$1",`
- Web GUI available at https://kinesiscorporation.github.io/Adv360-Pro-GUI
- Key positions documented in `assets/key-positions.md`

### Configuration Options
- N-Key Rollover: Modify `CONFIG_ZMK_HID_KEYBOARD_EXTENDED_REPORT` in defconfig files
- Battery reporting: Toggle `CONFIG_BT_BAS` in defconfig files  
- LED colors: Set `CONFIG_ZMK_RGB_UNDERGLOW_MOD_COLOR` for modifier indicators

### ZMK Fork Details
- Uses custom ZMK fork at github.com/ReFil/zmk (branch: adv360-z3.5-2)
- Includes Advantage 360 Pro specific features not in mainline ZMK
- Custom features include RGB indicator LEDs and other hardware-specific functionality

### Flashing Process
Firmware must be flashed to both keyboard halves using the UF2 files and the keyboard's bootloader mode (Mod+macro1 for left, Mod+macro3 for right).